<!doctype html> <!--Declaration of HTML5 document-->
<html lang="en"> <!--Root element with language attribute set to English-->
<head> <!--Head section containing metadata and links to resources-->
  <meta charset="utf-8"> <!--Character encoding set to UTF-8-->
  <meta name="viewport" content="width=device-width, initial-scale=1"> <!--Viewport settings for responsive design-->
  <title>Pay Now • Aurora Auctions</title> <!--Title of the webpage-->
  <link rel="stylesheet" href="/assets/css/main.css"> <!--Link to external CSS stylesheet for styling-->
</head> <!--End of head section-->
<body> <!--Start of body section containing visible content-->
  
<header class="site"> <!--Site-wide header-->
  <div class="inner"> <!--Layout wrapper for constraining width and adding padding-->
    <div class="brand"> <!--Grouping for logo and name-->
      <div class="logo" aria-hidden="true"></div> <!--Decorative logo. aria-hidden="true" informs the screen readers to ignore it as the brand name follows"-->
      <h1>Aurora Auctions</h1> <!--Site name for branding and SEO-->
    </div> <!--End of brand grouping-->
    <nav> <!--Navigation links-->
      <a href="/index.html">Home</a> <!--Link to home page-->
      <a href="/pages/browse.html">Browse</a> <!--Link to browse page-->
      <a href="/pages/sell.html">Sell</a> <!--Link to sell page-->
      <a href="/pages/profile.html">Profile</a> <!--Link to user profile page-->
      <a href="/pages/login.html" id="loginLink">Sign In</a> <!--Link to login page with ID for dynamic updates-->
      <button class="btn" id="logoutBtn" style="display:none">Sign Out</button> <!--Logout button, hidden by default, shown when user is logged in-->
    </nav> <!--End of navigation links-->
  </div> <!--End of layout wrapper-->
</header> <!--End of site-wide header-->
<script type="module"> //JavaScript module for handling user authentication and navigation state
import {DemoAPI, navActive} from '/assets/js/utils.js'; //Importing utility functions from external JS file
navActive(); //Highlight the active navigation link based on current page
const u = DemoAPI.user(); //Get the current user information
const loginLink = document.getElementById('loginLink'); //Get the login link element
const logoutBtn = document.getElementById('logoutBtn'); //Get the logout button element
if(u){ //If user is logged in
  loginLink.textContent = u.username; //Update login link text to show username
  loginLink.href = '/pages/profile.html'; //Change login link to point to profile page
  logoutBtn.style.display='inline-flex'; //Show the logout button
  logoutBtn.addEventListener('click', ()=>{ DemoAPI.signOut(); location.href='/index.html'; }); //Add click event to logout button to sign out user and redirect to home page
} //End of script for user authentication and navigation state 
</script> <!--End of script for user authentication and navigation state-->

  <main class="container"> <!--Main content area with constrained width-->
    <section class="card" style="max-width:720px;margin:0 auto"> <!--Card component for payment form, centered with max width-->
      <h2>Pay Now</h2> <!--Heading for the payment form-->
      <div id="summary"></div> <!--Summary of item and payment details-->
      <div class="grid cols-2"> <!--Grid layout with two columns for shipping and card details-->
        <div> <!--First column for shipping details-->
          <h3>Shipping</h3> <!--Heading for shipping details-->
          <div class="input"> <!--Input field container for address-->
            <label>Address</label> <!--Label for address textarea-->
            <textarea id="addr" rows="4"></textarea> <!--Textarea for entering shipping address-->
          </div> <!--End of input field container-->
          <div class="input"> <!--Input field container for shipping speed-->
            <label>Shipping Speed</label> <!--Label for shipping speed select-->
            <select id="ship"> <!--Select dropdown for choosing shipping speed-->
              <option value="standard">Standard</option> <!--Option for standard shipping-->
              <option value="expedited">Expedited (+ cost)</option> <!--Option for expedited shipping-->
            </select> <!--End of select dropdown-->
          </div> <!--End of input field container-->
        </div> <!--End of first column-->
        <div> <!--Second column for card details-->
          <h3>Card</h3> <!--Heading for card details-->
          <div class="input"><label>Card Number</label><input id="cc" placeholder="4111 1111 1111 1111"></div> <!--Input field for card number-->
          <div class="grid cols-2"> <!--Grid layout with two columns for expiry and CVC-->
            <div class="input"><label>Expiry</label><input id="exp" placeholder="MM/YY"></div> <!--Input field for card expiry date-->
            <div class="input"><label>CVC</label><input id="cvc" placeholder="123"></div> <!--Input field for card CVC code-->
          </div> <!--End of grid layout for expiry and CVC-->
          <button class="btn primary" id="payBtn">Submit Payment</button> <!--Button to submit payment-->
        </div> <!--End of second column-->
      </div> <!--End of grid layout-->
    </section> <!--End of card component-->
  </main> <!--End of main content area-->
  
<footer> <!--Site-wide footer-->
  <div>© 2025 Aurora Auctions — Front-end demo. Configure your middle-tier URL in <span class="kbd">localStorage.API_BASE_URL</span>.</div> <!--Footer text with copyright and configuration info-->
</footer> <!--End of site-wide footer-->

  <script type="module"> //JavaScript module for payment processing
    import { $, DemoAPI, formatCurrency } from '/assets/js/utils.js'; //Importing utility functions from external JS file
    const params = new URLSearchParams(location.search); //Get URL parameters
    const id = params.get('id'); //Get item ID from URL parameters
    let item, price, shipStd, shipExp; //Variables to hold item details and pricing
    async function init(){ //Initialization function to load item and set up event listeners
      const user = DemoAPI.user(); //Get the current user information
      item = await DemoAPI.item(id); //Fetch item details from API
      if(!item){ $('#summary').innerHTML='<p>Item not found.</p>'; return; } //If item not found, display message
      shipStd = item.shipCost||20; shipExp = item.shipCostExp||40; //Set standard and expedited shipping costs
      price = item.winPrice || item.currentPrice || item.priceNow; //Determine item price
      $('#addr').value = user?.address || ''; //Pre-fill address field with user's address if available
      renderSummary(); //Render the payment summary
      $('#ship').addEventListener('change', renderSummary); //Update summary when shipping option changes
      $('#payBtn').addEventListener('click', pay); //Add click event listener to payment button
    } //End of initialization function
    function renderSummary(){ //Function to render payment summary
      const ship = $('#ship').value==='expedited' ? shipExp : shipStd; //Determine shipping cost based on selected option
      const total = price + ship; //Calculate total cost
      $('#summary').innerHTML = ` <!--HTML template for payment summary-->
        <p>Item: <strong>${item.title}</strong></p> <!--Item title-->
        <p>Price: <strong>${formatCurrency(price)}</strong></p> <!--Item price-->
        <p>Shipping: <strong>${formatCurrency(ship)}</strong></p> <!--Shipping cost-->
        <p>Total: <strong>${formatCurrency(total)}</strong></p> <!--Total cost-->
      `; //End of HTML template
    } //End of render summary function
    function pay(){ //Function to handle payment submission
      if(!$('#cc').value || !$('#exp').value || !$('#cvc').value){ alert('Complete card fields'); return; } //Validate card fields
      // Normally POST to middle-tier payment service; we simulate success:
      localStorage.setItem('LAST_RECEIPT', JSON.stringify({ //Store receipt details in localStorage
        id: crypto.randomUUID(), //Generate a random UUID for the receipt
        itemId: item.id, title: item.title, price, //Item details
        ship: $('#ship').value==='expedited' ? shipExp : shipStd, //Shipping cost
        total: price + ( $('#ship').value==='expedited' ? shipExp : shipStd ), //Total cost
        days: item.shippingDays || 5, //Estimated shipping days
        when: new Date().toISOString() //Timestamp of the transaction
      })); //End of storing receipt details
      location.href='/pages/receipt.html'; //Redirect to receipt page
    } //End of pay function
    init(); //Call initialization function on page load
  </script> <!--End of script for payment processing-->
</body> <!--End of body section-->
</html> <!--End of HTML document-->