<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sign In • Aurora Auctions</title>
  <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
<header class="site">
  <div class="inner">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>Aurora Auctions</h1>
    </div>
    <nav>
      <a href="/index.html">Home</a>
      <a href="/pages/browse.html">Browse</a>
      <a href="/pages/sell.html">Sell</a>
      <a href="/pages/profile.html">Profile</a>
      <a href="/pages/login.html" id="loginLink">Sign In</a>
      <button class="btn" id="logoutBtn" style="display:none">Sign Out</button>
    </nav>
  </div>
</header>
<script type="module">
  import {DemoAPI, navActive} from '/assets/js/utils.js';
  navActive();
  const u = DemoAPI.user();
  const loginLink = document.getElementById('loginLink');
  const logoutBtn = document.getElementById('logoutBtn');
  if(u){
    loginLink.textContent = u.username;
    loginLink.href = '/pages/profile.html';
    logoutBtn.style.display='inline-flex';
    logoutBtn.addEventListener('click', ()=>{ DemoAPI.signOut(); location.href='/index.html'; });
  }
</script>

<main class="container">
  <section class="card" style="max-width:700px;margin:0 auto">
    <h2>Access Your Account</h2>

    <div class="tabs">
      <button class="btn" data-tab="signin">Sign In</button>
      <button class="btn" data-tab="register">Create Account</button>
    </div>

    <!-- Sign In (2-step: password, then verification code) -->
    <div id="tab-signin">
      <div class="input"><label>Username</label><input id="su" placeholder="e.g. johndoe"></div>
      <div class="input"><label>Password</label><input id="sp" type="password" placeholder="••••••••"></div>
      <button class="btn primary" id="startSignIn">Continue</button>
      <p class="helper" id="signInHint" style="display:none">We sent a verification code. Enter it below.</p>
      <div id="verifyBlock" class="hidden">
        <div class="input"><label>Verification Code</label><input id="code" placeholder="6-digit code"></div>
        <button class="btn" id="doVerify">Verify & Sign In</button>
      </div>
    </div>

    <!-- Register -->
    <div id="tab-register" class="hidden">
      <div class="grid cols-2">
        <div class="input"><label>Username</label><input id="ru" placeholder="johndoe"></div>
        <div class="input"><label>Password</label><input id="rp" type="password" placeholder="••••••••"></div>
        <div class="input"><label>First Name</label><input id="rf" placeholder="John"></div>
        <div class="input"><label>Last Name</label><input id="rl" placeholder="Doe"></div>
      </div>
      <div class="input"><label>Address</label><input id="ra" placeholder="123 Yonge St, Toronto, ON"></div>
      <button class="btn primary" id="doRegister">Create Account</button>
      <p class="helper">Your account is stored in the backend if configured; otherwise it’s saved in the local demo store for testing.</p>
    </div>
  </section>
</main>

<footer>
  <div>© 2025 Aurora Auctions</div>
</footer>

<script type="module">
  import { $, DemoAPI } from '/assets/js/utils.js';

  // tabs
  $$('.tabs [data-tab]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const name = btn.dataset.tab;
      $('#tab-signin').classList.toggle('hidden', name!=='signin');
      $('#tab-register').classList.toggle('hidden', name!=='register');
    });
  });

  // Registration
  $('#doRegister').addEventListener('click', async ()=>{
    try{
      const data = {
        username: $('#ru').value.trim(),
        password: $('#rp').value,
        firstName: $('#rf').value.trim(),
        lastName:  $('#rl').value.trim(),
        address:   $('#ra').value.trim(),
      };
      await DemoAPI.register(data);
      alert('Account created. You can sign in now.');
      // switch to sign-in tab
      document.querySelector('[data-tab="signin"]').click();
    }catch(e){ alert(e.message); }
  });

  // Sign-in start
  $('#startSignIn').addEventListener('click', async ()=>{
    try{
      await DemoAPI.signInStart($('#su').value.trim(), $('#sp').value);
      $('#signInHint').style.display='block';
      $('#verifyBlock').classList.remove('hidden');
    }catch(e){ alert(e.message); }
  });

  // Verify code
  $('#doVerify').addEventListener('click', async ()=>{
    try{
      await DemoAPI.signInVerify($('#code').value.trim());
      location.href = '/pages/browse.html';
    }catch(e){ alert(e.message); }
  });
</script>
</body>
</html>